{% extends '@layouts::base.twig' %}

{#
 # Email subject
 # ---
 # A shipment from order {{ name }} is on the way
 #}

{# title - start #}
{% block title %}
  {% verbatim %}
  {% capture title %}{% endcapture %}
  {% endverbatim %}

  {{ parent() }}
{% endblock %}
{# title - end #}

{# preview - start #}
{% block preview %}
  {% verbatim %}

    {% capture delivery_brief %}
      Hi {{ customer.first_name }}, <br/>
      {% if fulfillment.item_count == item_count %}
        Your order is on the way!
      {% elsif fulfillment.item_count > 1 %}
        {% if fulfillment_status == 'fulfilled' %}
          Final shipment of your order are on the way!
        {% else %}
          Part of your order is on the way!
        {% endif %}
      {% else %}
        {% if fulfillment_status == 'fulfilled' %}
          Final shipment of your order are on the way!
        {% else %}
          Part of your order is on the way!
        {% endif %}
      {% endif %}
    {% endcapture %}

    {% capture tracking_company %}
      {% if fulfillment.tracking_numbers.size > 0 and fulfillment.tracking_company %}
        {{ fulfillment.tracking_company }}
      {% endif %}
    {% endcapture %}

    {% if fulfillment.tracking_company %}
      {% assign with_tracking_company = ' via ' | append: tracking_company %}
    {% else %}
      {% assign with_tracking_company = '' %}
    {% endif %}

    {# {% capture fulfillment_status_text %}
      {% if fulfillment_status == 'fulfilled' %}
        (fulfilled)
      {% else %}
        (partially fulfilled)
      {% endif %}
    {% endcapture %} #}

    {% capture preview %}
      <!-- greeting -->
      <div class="intro-text">
        {% if shipping_method.title == "Click and Collect — Wellington Store" %}
          <p>Hi {{ customer.first_name }}, <br/>Thank you for shopping with us.</p>
          <p>Your order is ready for you to collect from our Wellington Flagship Store located at 29 College Street.</p>
          <p>When you arrive one of our retail staff will assist you.</p>
          <p>Our opening hours are:
            <br>Monday - Saturday 10am – 5pm
            <br>Sunday 11am – 4pm
          </p>
          <p>Click and Collect orders will be held in-store for 14 days. If your order is not collected within this timeframe, it will be cancelled and you will be refunded via your original payment method. </p>
          <p>If you have any questions, please do not hesitate to get in touch. You can contact us via email at wellington@kowtowclothing.com, or by phone on 04 555 0457.</p>
          <p>We look forward to seeing you soon.</p>

        {% elsif shipping_method.title == "Click and Collect — Newmarket Store" %}
          <p>Hi {{ customer.first_name }}, <br/>Thank you for shopping with us.</p>
          <p>Your order is ready for you to collect from our Newmarket Store located at 6 York Street.</p>
          <p>When you arrive one of our retail staff will assist you.</p>
          <p>Our opening hours are:
            <br>Monday - Saturday 10am – 5pm
            <br>Sunday 11am – 4pm
          </p>
          <p>Click and Collect orders will be held in-store for 14 days. If your order is not collected within this timeframe, it will be cancelled and you will be refunded via your original payment method. </p>
          <p>If you have any questions, please do not hesitate to get in touch. You can contact us via email at newmarket@kowtowclothing.com, or by phone on 09 869 4583.</p>
          <p>We look forward to seeing you soon.</p>

        {% else %}
          <p>{{ delivery_brief }}</p>
          <p>
            {% if fulfillment.item_count == item_count %}
              <!-- all dispatch in one shipment -->
              And will be delivered to you shortly {{ with_tracking_company }}.
            {% elsif fulfillment.item_count > 1 %}
              {% if fulfillment_status == 'fulfilled' %}
                <!-- last shipment -->
                And will be delivered shortly {{ with_tracking_company }}.
              {% else %}
                <!-- partial shipment -->
                And will be delivered to you shortly {{ with_tracking_company }}. The remaining item/s in your order will be sent separately, and you will receive a new confirmation once this has shipped.
              {% endif %}
            {% else %}
              {% if fulfillment_status == 'fulfilled' %}
                <!-- last item of order -->
                And will be delivered shortly {{ with_tracking_company }}.
              {% else %}
                <!-- last item of order -->
                And will be delivered shortly {{ with_tracking_company }}.
              {% endif %}
            {% endif %}
          </p>
        {% endif %}
        <p>Our current delivery time frames are 2-3 working days. Please refer to our <a href="{{ order_status_url }}" target="_blank" rel="noopener noreferrer">shipping page</a> for any current updates.</p>
      </div>
    {% endcapture %}
  {% endverbatim %}

  {{ parent() }}
{% endblock %}
{# preview - end #}

{# content - start #}
{% block content %}
  {% include '@components::local/intro-text.twig' with {
    headline: '{{ title }}',
    text: '{{ preview }}'
  } %}

  {% verbatim %}
    <mj-raw>
      {% if fulfillment.tracking_url and fulfillment.tracking_company %}
    </mj-raw>
  {% endverbatim %}

    {% include '@components::local/actions.twig' with {
      primary: {
        url: '{{ fulfillment.tracking_url }}',
        text: 'TRACK YOUR ORDER'
      }
    } %}

  {% verbatim %}
    <mj-raw>
      {% elsif fulfillment.tracking_url %}
    </mj-raw>
  {% endverbatim %}

  {% include '@components::local/actions.twig' with {
    primary: {
      url: '{{ fulfillment.tracking_url }}',
      text: 'TRACK THIS SHIPMENT'
    }
  } %}

  {% verbatim %}
    <mj-raw>
      {% endif %}
    </mj-raw>
  {% endverbatim %}

  <mj-section>
    <mj-column css-class="full-width">
      <mj-divider border-color="{{ style.color['black'] }}" padding="48px 0 40px" />
    </mj-column>
  </mj-section>

  <mj-section padding="{{ padding | default('0 0 20px') }}">
    <mj-column>
      {% block topline_outer %}
        <mj-text
          font-size="20px"
          font-weight="700"
          align="center"
        >
          {% block topline %}
            {{ topline | default('ORDER {{ name }}') }}
          {% endblock %}
        </mj-text>
        <mj-text
          font-size="16px"
          align="center"
        >
          {% verbatim %}
            <br/>
            {% assign current_date = date | date: "%b %d" %}
            Shipped at: {{ current_date }}
          {% endverbatim %}
        </mj-text>
          {% include '@components::local/estimated-delivery.twig' %}
          {% include '@components::local/tracking.twig' %}
      {% endblock %}
    </mj-column>
  </mj-section>

  {% include '@components::local/headline.twig' with {
    headline: 'Items in this shipment',
    padding: '20px 0 5px'
  } %}

  <mj-wrapper padding-bottom="20px">
    <mj-raw>
      {{ development
        ? '{% for line in line_items %}'
        : '{% for line in fulfillment.fulfillment_line_items %}'
      }}
    </mj-raw>

      {% embed '@components::local/product.twig' %}
        {% block right %}{% endblock %}
      {% endembed %}

    <mj-raw>
      {{ development
        ? '{% endfor %}'
        : '{% endfor %}'
      }}
    </mj-raw>
  </mj-wrapper>
  <mj-section>
    <mj-column css-class="full-width">
      <mj-divider border-color="{{ style.color['black'] }}" padding="24px 0 16px" />
    </mj-column>
  </mj-section>
  {% embed '@components::local/faq.twig' %}
    {% block faq_content_1 %}
        <mj-text
          color="{{ style.color['grey-dark'] }}"
          font-size="14px"
          line-height="1.7"
        >
        {% verbatim %}
          {% capture heading %}FREQUENTLY ASKED QUESTIONS{% endcapture %}
          {% capture q1 %}Why has only part of my order shipped?{% endcapture %}
          {% capture a1 %}Some items in your order may be fulfilled from different store locations. You will receive a new  shipping update with a tracking number for each part of your order.{% endcapture %}
          <div class="faq-heading">{{ heading }}</div>
          <div class="faq">
            <p class="q">{{ q1 }}</p>
            <p class="a">{{ a1 }}</p>
          </div>
        {% endverbatim %}
        </mj-text>
      {% endblock %}
  {% endembed %}
{% endblock %}
{# content - end #}